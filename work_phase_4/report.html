<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Fixed Thumbnail Overflow +N</title>
        <style>
            .thumbnails-wrapper {
                display: flex;
                flex-wrap: nowrap;
                overflow: hidden;
                gap: 8px;
                width: 360px; /* 你可以改小测试裁切 */
                padding: 8px;
                box-sizing: border-box;
                border: 1px solid #ccc;
            }

            .thumbnail-container {
                flex: 0 0 auto;
                width: 100px;
                height: 100px;
                position: relative;
                overflow: hidden;
                border-radius: 6px;
                background-color: #eee;
            }

            .thumbnail-container img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                display: block;
            }

            .thumbnail-overlay {
                position: absolute;
                right: 4px;
                bottom: 4px;
                background: rgba(0, 0, 0, 0.6);
                color: white;
                font-size: 12px;
                padding: 2px 6px;
                border-radius: 4px;
                pointer-events: none;
            }
        </style>
    </head>
    <body>
        <h2>测试缩略图裁切 + 显示“+N”</h2>
        <div id="thumbnailWrapper" class="thumbnails-wrapper">
            <div class="thumbnail-container">
                <img src="https://placekitten.com/100/100" alt="" />
            </div>
            <div class="thumbnail-container">
                <img src="https://placekitten.com/101/100" alt="" />
            </div>
            <div class="thumbnail-container">
                <img src="https://placekitten.com/102/100" alt="" />
            </div>
            <div class="thumbnail-container">
                <img src="https://placekitten.com/103/100" alt="" />
            </div>
            <div class="thumbnail-container">
                <img src="https://placekitten.com/104/100" alt="" />
            </div>
            <div class="thumbnail-container">
                <img src="https://placekitten.com/105/100" alt="" />
            </div>
            <div class="thumbnail-container">
                <img src="https://placekitten.com/106/100" alt="" />
            </div>
        </div>

        <script type="module">
            function updateVisibleThumbnails(wrapper) {
                const containers = Array.from(
                    wrapper.querySelectorAll(".thumbnail-container")
                );
                const wrapperRect = wrapper.getBoundingClientRect();
                const wrapperRight = wrapperRect.right;

                let visibleCount = 0;
                wrapper
                    .querySelectorAll(".thumbnail-overlay")
                    .forEach((el) => el.remove());

                containers.forEach((container) => {
                    const rect = container.getBoundingClientRect();
                    if (rect.right <= wrapperRight) {
                        container.style.display = "";
                        visibleCount++;
                    } else {
                        container.style.display = "none";
                    }
                });

                const hiddenCount = containers.length - visibleCount;
                if (hiddenCount > 0 && visibleCount > 0) {
                    const lastVisible = containers[visibleCount - 1];
                    lastVisible.style.display = "";

                    const overlay = document.createElement("div");
                    overlay.className = "thumbnail-overlay";
                    overlay.textContent = `+${hiddenCount}`;
                    lastVisible.appendChild(overlay);
                }
            }

            function initThumbnailLimit() {
                const wrapper = document.getElementById("thumbnailWrapper");
                if (!wrapper) return;

                const imgs = wrapper.querySelectorAll("img");
                let loaded = 0;

                imgs.forEach((img) => {
                    if (img.complete) {
                        loaded++;
                    } else {
                        img.addEventListener("load", () => {
                            loaded++;
                            if (loaded === imgs.length)
                                updateVisibleThumbnails(wrapper);
                        });
                        img.addEventListener("error", () => {
                            loaded++;
                            if (loaded === imgs.length)
                                updateVisibleThumbnails(wrapper);
                        });
                    }
                });

                if (loaded === imgs.length) {
                    updateVisibleThumbnails(wrapper);
                }

                window.addEventListener("resize", () =>
                    updateVisibleThumbnails(wrapper)
                );
            }

            // 启动逻辑
            initThumbnailLimit();
        </script>
    </body>
</html>
